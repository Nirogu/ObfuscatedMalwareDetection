"""Image classification performance. Helper script."""
from os import path, listdir
from sys import argv
from random import sample
from time import perf_counter
from fastai.learner import load_learner

# Get script parameters
MODEL_NAME = argv[1]
NUM_SAMPLES = int(argv[2])

FOLDER = "NonObfuscatedImg/Goodware"
files = sample(listdir(FOLDER), NUM_SAMPLES)
files = [path.join(FOLDER, f) for f in files]

# Load model
learner = load_learner(MODEL_NAME, cpu=True)

# Measure time
process_time = perf_counter()

# Process every image
for f in files:
    learner.predict(f)

process_time = perf_counter() - process_time

# Write results
with open('performance.csv', 'a', encoding='utf8') as logs:
    logs.write(f"{MODEL_NAME},{NUM_SAMPLES},{process_time}")
